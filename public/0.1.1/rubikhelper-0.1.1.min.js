/*! RubikHelper - v0.1.1 - 2015-05-04 */
var RubikHelper=function(){var a=function(){var a=function(){function a(){this._attributes={}}return a.prototype={set:function(a,b){return this._attributes[a]=b,this},get:function(a){return this._attributes[a]},_extend:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]&&a[c]instanceof Object&&!(a[c]instanceof Array)?this._extend(a[c],b[c]):a[c]=b[c])}},a}(),b=function(){function a(a,b,c){this.x=parseFloat(a)||0,this.y=parseFloat(b)||0,this.z=parseFloat(c)||0}return a.prototype={toOrtho:function(){return new a(this.x-this.y,(this.x+this.y)/2-1.25*this.z,0)},toIso:function(){return new a(this.y+this.x/2,this.y-this.x/2,0)},toString:function(){return"{x:"+this.x+", y:"+this.y+", z:"+this.z+"}"},toObject:function(){return{x:this.x,y:this.y,z:this.z}},toArray:function(){return[this.x,this.y,this.z]},add:function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z)},subtract:function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)},multiply:function(b){return new a(this.x*b.x,this.y*b.y,this.z*b.z)},distance:function(a){var b=Math.abs(this.x-a.x),c=Math.abs(this.y-a.y),d=Math.abs(this.z-a.z),e=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));return Math.sqrt(Math.pow(e,2)+Math.pow(d,2))}},a}(),c=function(){function a(a){this._stepCallback=null,this._animation=null,this._startTime=0,a&&this.setCallback(a),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()}return a.prototype={setCallback:function(a){this._stepCallback=a},start:function(a){this._startTime=(new Date).getTime(),this._animate(),a&&setTimeout(function(){this.stop()}.bind(this),a)},stop:function(){cancelRequestAnimFrame(this._animation),this._animation=null},_animate:function(){this._stepRender(),this._animation=requestAnimFrame(this._animate.bind(this))},_stepRender:function(){var a=(new Date).getTime()-this._startTime;this._stepCallback&&this._stepCallback(a)}},a}(),d=function(){function a(a){this.context=a,this.message=null,this.messageOrigin={x:0,y:0},this.isPath=!1,this.isStroke=!1}return a.prototype={setup:function(a){a||(a={});var b=null==a.fillColor?null:this.castToColor(a.fillColor),c=null==a.strokeColor?null:this.castToColor(a.strokeColor),d=a.strokeSize;this.context.restore(),this.context.fillStyle=b,this.context.strokeStyle=c,this.context.lineWidth=d,this.context.globalAlpha=a.alpha||1,this.context.font=a.font||"20px Open Sans",this.context.save(),this.isStroke=null!=c,this.isPath=null!=b,this.isPath&&this.context.beginPath()},render:function(){this.message&&(this.isPath&&this.context.fillText(this.message,this.messageOrigin.x,this.messageOrigin.y),this.isStroke&&this.context.strokeText(this.message,this.messageOrigin.x,this.messageOrigin.y),this.message=null),this.isPath&&this.context.closePath(),this.isPath&&this.context.fill(),this.isPath=!1,this.isStroke&&this.context.stroke(),this.isStroke=!1},moveTo:function(a,b){var c=this.isPath||this.isStroke;return c&&this.context.moveTo(a,b),c},lineTo:function(a,b){var c=this.isPath||this.isStroke;return c&&this.context.lineTo(a,b),c},text:function(a,b){if(!a)return[];b||(b=[0,0]),b=this.castToPoint(b),this.messageOrigin=b,this.message=a;var c=this.context.measureText(a),d=this.context.font,e=Math.ceil(c.width),f=parseInt(d);return isNaN(f)&&(d=d.substr(d.indexOf(" ")),f=parseInt(d)),[b.add([0,0]),b.add([e,0]),b.add([e,-f]),b.add([0,-f])]},line:function(a,b,c){return a&&b?(a=this.castToPoint(a),b=this.castToPoint(b),c&&(a=a.toOrtho(),b=b.toOrtho()),this.moveTo(a.x,a.y)&&this.lineTo(b.x,b.y)):!1},polygon:function(a,b,c){if(!a)return[];b||(b=[0,0,0]),b=this.castToPoint(b),a=a.map(function(a){return this.castToPoint(a)}.bind(this)),c&&(b=b.toOrtho()),c&&(a=a.map(function(a){return a.toOrtho()}));var d,e,f=b.add(a[0]),g=[];for(this.moveTo(f.x,f.y)&&g.push(f),d=1;d<a.length;d++)e=b.add(a[d]),this.lineTo(e.x,e.y)&&g.push(e);return this.lineTo(f.x,f.y),g},image:function(){},castToColor:function(a){var b="string"==typeof a?a:"number"==typeof a?a.toString(16):null;return null!=b&&"#"==b.substr(0,1)&&(b=b.substr(1)),null!=b&&(b="#"+("00000"+b).substr(-6)),b},castToPoint:function(a){var c;return a instanceof b?c=a:"object"==typeof a&&null!=a.x&&null!=a.y?c=new b(parseFloat(a.x),parseFloat(a.y),parseFloat(a.z)):"object"==typeof a&&a.length>1&&a.length<4&&(c=new b(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),c}},a}(),e=function(a,b){function c(c){if(!c)throw new Error('no "name" provided for this displayObject:',this);if(a.call(this),this._name=c,this._parent=null,this._zIndex=0,this._position=new b,this._shape=null,this._info={stepCallback:null,renderMethod:null,renderInfo:null},this._options={strokeColor:0,fillColor:0,strokeSize:1,alpha:1,font:"14px Arial"},this[c])throw new Error('property "%s" already exists on',c,this)}return c.prototype=Object.create(a.prototype),c.prototype.setOptions=function(a){return a?(this._extend(this._options,a),!0):!1},c.prototype.setRenderInfo=function(a,b){b&&this.setOptions(b),this._info.renderInfo=a},c.prototype.setAnimationStep=function(a){this._info.stepCallback=a.bind(this)},c.prototype._addTo=function(a,b){this._zIndex=b||0,this._parent=a},c.prototype._remove=function(){delete this},c.prototype._render=function(a,b){if(!this._info.renderMethod)throw new Error("no renderMethod set for this instance of DisplayObject: ",this);return this._info.renderInfo?(a._info.draw.setup(this._options),this._shape=a._info.draw[this._info.renderMethod](this._info.renderInfo,this._position,b),a._info.draw.render(),!0):!1},c.prototype._step=function(a){return this._info.stepCallback&&this._info.stepCallback(a),!0},c}(a,b),f=function(a){function b(b){a.call(this,b),this._info.renderMethod="image"}return b.prototype=Object.create(a.prototype),b.prototype.render=function(){},b}(e),g=function(a){function b(b){a.call(this,b),this._options.font=this.getFont("Verdana",14),this._options.fillColor=0,this._options.strokeColor=null,this._info.renderMethod="text"}return b.prototype=Object.create(a.prototype),b.prototype.getFont=function(a,b,c){return a?(c||(c=""),b||(b=""),"number"==typeof b&&(b+="px"),[c,b,a].join(" ")):""},b.prototype.setFont=function(a,b,c){return a?(this._options.font=this.getFont(a,b,c),!0):!1},b}(e),h=function(a){function b(b){a.call(this,b),this._options.fillColor=null,this._options.strokeColor=0,this._info.renderMethod="polygon"}return b.prototype=Object.create(a.prototype),b}(e),i=function(a){function b(b){a.call(this,b),this._children={},this._childrenLength=function(){var a=0;return c(this,function(){a++}),a}.bind(this._children),this._childrenArray=function(){var a=[];return c(this,function(b){a.push(b)}),a.sort(function(a,b){return a._zIndex-b._zIndex})}.bind(this._children)}function c(a,b){if(a&&b)for(var c in a)a.hasOwnProperty(c)&&b(a[c])}return b.prototype=Object.create(a.prototype),b.prototype._render=function(a,b){this._childrenArray().forEach(function(c){c._render(a,b)})},b.prototype._step=function(b){return this._childrenArray().forEach(function(a){a._step(b)}),a.prototype._step.call(this,b),!0},b.prototype.addChild=function(b,c){if(!(b instanceof a))throw new Error("adding child with unsupported type:",typeof b);if(this[b._name])throw new Error('property "',b._name,'" already exists on',this);return c||(c=this._childrenLength()),this._children[b._name]=b,this[b._name]=b,b._addTo(this,c),this._reorderChildren(),b},b.prototype.removeChild=function(b){b instanceof String&&(b=this[b]),b&&this[b._name]&&this[b._name]instanceof a&&(delete this._children[b._name],delete this[b._name],b._remove())},b.prototype._reorderChildren=function(){this._childrenArray().forEach(function(a,b){a._info.index=b})},b.prototype._getShapes=function(){for(var a,c=[],d=0;d<this._children.length;d++)a=this._children[d],a._shape&&c.push(a._shape),a instanceof b&&(c=c.concat(a._getShapes()));return c},b.prototype._getShapesWithObjects=function(){for(var a,c=this._childrenArray(),d=[],e=0;e<c.length;e++)a=c[e],a._shape&&d.push(a),a instanceof b&&(d=d.concat(a._getShapesWithObjects()));return d},b}(e),j=function(a,b){function e(e,f){b.call(this,"_stage_"+e),this._engine=null,this._info.size={w:0,h:0},this._info.canvas=document.createElement("canvas"),this._info.context=this._info.canvas.getContext("2d"),this._info.draw=new d(this._info.context),this._info.animator=new c(this.renderTime.bind(this)),this._info.modes={ORTHOGONAL:"ORTHOGONAL",ISOMETRIC:"ISOMETRIC"},this._info.mode=f?this._info.modes.ISOMETRIC:this._info.modes.ORTHOGONAL,this.$el=a("<div/>").addClass("iso-layer").css({position:"absolute",top:0,left:0}).append(this._info.canvas)}return e.prototype=Object.create(b.prototype),e.prototype._render=function(){this.clear(),b.prototype._render.call(this,this,this._info.mode==this._info.modes.ISOMETRIC)},e.prototype._remove=function(){this.$el.remove()},e.prototype._addTo=function(a){if(a){var b=a.worldSize();this.setSize(b.w,b.h),this.$el.appendTo(a.$el),this._engine=a}},e.prototype.toggleMode=function(a){this._info.modes[a]&&this.mode!=a&&(this.mode=a,this._render())},e.prototype.clear=function(){this._info.context.clearRect(-this._info.size.w/2,-this._info.size.h/2,this._info.size.w,this._info.size.h)},e.prototype.getCanvas=function(){return this._info.canvas},e.prototype.renderTime=function(a){this._step(a)&&this._render()},e.prototype.startAnimation=function(a){this._info.animator.start(a)},e.prototype.stopAnimation=function(){this._info.animator.stop()},e.prototype.setSize=function(a,b){this._info.size={w:a,h:b},this._info.canvas.width=a.toString(),this._info.canvas.height=b.toString(),this._info.context.translate(a/2,b/2)},e.prototype.setShadow=function(a,b,c,d){this._info.context.shadowColor=a||"#999",this._info.context.shadowBlur=b||20,this._info.context.shadowOffsetX=c||15,this._info.context.shadowOffsetY=d||c||15},e}(jQuery,i),k=function(a){function b(b){a.call(this,b)}return b.prototype=Object.create(a.prototype),b}(i),l=function(a,b){function c(){this.$el=a("<div/>"),this.layers={},this.fpsInterval=null,this.fpsLogInterval=null,this.utils={worldSizeWidth:400,worldSizeHeight:400}}function d(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c}return c.prototype={init:function(b,c){if(!b)throw new Error('no "elem" param passed to new Engine instance');c&&a.extend(!0,this.utils,c),this.setWorld(b)},setWorld:function(b){if(this.$el){var c=this.worldSize();this.$el.css("position","relative").width(c.w).height(c.h).appendTo(a(b))}},worldSize:function(){return{w:this.utils.worldSizeWidth,h:this.utils.worldSizeHeight}},render:function(){for(var a in this.layers)this.layers.hasOwnProperty(a)&&this.layers[a]._render()},addLayer:function(a,c){var d=new b(a,c);return d._addTo(this),this.layers[a]=d,d},removeLayer:function(a){var b=this.layers[a];return b?(b.remove(),delete this.layers[a],!0):!1},showFPS:function(a){a||(a=console.log);var b=0;this.fpsInterval=setInterval(function(){b++},1),this.fpsLogInterval=setInterval(function(){a(b/10),b=0},1e3)},hideFPS:function(){clearInterval(this.fpsInterval),clearInterval(this.fpsLogInterval)},screenToWorld:function(a,b){var c=this.worldSize(),d=this.$el.offset();return{x:a-(d.left+c.w/2),y:b-(d.top+c.h/2)}},getObjectsAtScreenCoord:function(a){var b=this.screenToWorld(a.x,a.y),c=[];for(var e in this.layers)this.layers.hasOwnProperty(e)&&(c=c.concat(this.layers[e]._getShapesWithObjects()));for(var f=[],g=0;g<c.length;g++)c[g]._shape&&d(c[g]._shape,b)&&f.push(c[g]);return f.sort(function(a,b){return b.zIndex-a.zIndex}),f},drawUtils:{grid:function(a,b,c,d,e){if(!a)throw new Error("calling draw method without providing a Stage instance");b||(b=[10,10]),c||(c=10),d||(d={}),d.strokeSize||(d.strokeSize=1),d.strokeColor||(d.strokeColor=0),d.alpha||(d.alpha=.8),a._info.draw.setup(d);for(var f=0;f<=b[0];f++)a._info.draw.line([f*c,0],[f*c,b[0]*c],e);for(var g=0;g<=b[1];g++)a._info.draw.line([0,g*c],[b[1]*c,g*c],e);a._info.draw.render()},line:function(a,b,c,d,e){if(!a)throw new Error("calling draw method without providing a Stage instance");null!=b&&null!=c&&(d&&a._info.draw.setup(d),a._info.draw.line(b,c,e),a._info.draw.render())},axis:function(a,b,c){if(!a)throw new Error("calling draw method without providing a Stage instance");b||(b=100);var d=[b,0,0],e=[0,b,0],f=[0,0,b];a._info.draw.setup({strokeColor:0}),a._info.draw.line([0,0,0],d,c),a._info.draw.line([0,0,0],e,c),a._info.draw.line([0,0,0],f,c),a._info.draw.render()},get3DPolygonSquare:function(a){return[[0,0,0],[a,0,0],[a,a,0],[0,a,0]]},get3DPolygonSquareRight:function(a){return[[0,0,0],[0,a,0],[0,a,a],[0,0,a]]},get3DPolygonSquareLeft:function(a){return[[0,0,0],[0,0,a],[a,0,a],[a,0,0]]}}},c}(jQuery,j),m=function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};return m.core={},m.core.Engine=a,m.core.ObjectModel=b,m.core.Point=c,m.display={},m.display.Bitmap=d,m.display.DisplayObject=e,m.display.DisplayObjectContainer=f,m.display.Shape=g,m.display.Sprite=h,m.display.Stage=i,m.display.Text=j,m.utils={},m.utils.Animator=k,m.utils.Draw=l,m}(l,a,b,f,e,i,h,k,j,g,c,d);return m}(),b=function(){return{colors:{U:"#ffff00",D:"#ffffff",F:"#ff0000",B:"#ffaa00",L:"#0000ff",R:"#008800",light:"#ffff00",grey:"#cccccc",core:"#222222"},patterns:{p_O4U:" (M'U)4   (MU)4 ",p_O4D:" (M'D)4   (MD)4 ",p_O4F:" (M'F)4   (MF)4 ",p_O4B:" (M'B)4   (MB)4 ",p_O2U:" (M'U)3 U (MU)3 U ",p_O2D:" (M'D)3 D (MD)3 D ",p_O2F:" (M'F)3 F (MF)3 F ",p_O2B:" (M'B)3 B (MB)3 B ",p_O6L:" (R'FRU)5 ",p_O6R:" ([O6L])m ",p_CW2:" (U'RU) R' (U'RU) ",p_CC2:" ([CW2])i ",p_CW3:" ((UR)'UR)2 ",p_CC3:" ([CW3])i ",p_PTJ:" (L'U2) LU (L'U2) (RU') L (RU')i ",p_PTN:" ((L'UR') U2 (L'UR')')2 U ",p_PAR:" (U'F2) [PTJ] (U'F2)i ",p_PRN:" (F2y) [PTN] (F2y)i",s_UB:" ",s_UF:" (U2 M')2 ",s_DB:" ([UF])i ",s_UR:" R'U RU' ",s_DR:" U R RU' ",s_FR:"  URU' ",s_BR:" ([FR])i ",s_UL:" ([UR])m ",s_DL:" ([DR])m ",s_FL:" ([FR])m ",s_BL:" ([BR])m ",s_BU:" [UB] ",s_FU:" [UF] ",s_BD:" [DB] ",s_RU:" x' ([BR])' ",s_RD:" x' ([FR])' ",s_RF:" x' ([DR])' ",s_RB:" x' ([UR])' ",s_LU:" x' (([BR])')m ",s_LD:" x' (([FR])')m ",s_LF:" x' (([DR])')m ",s_LB:" x' (([UR])')m ",s_UBR:" ",s_URF:" U' (R F' RM' U R2 U') (MR' F R U R2') ",s_DRB:" ([URF])i ",s_ULB:" (LU)' (LU)",s_UFL:" L U'L' U [ULB] ",s_DLF:" U' L2 U ",s_DBL:" [DLF] [ULB] ",s_BRU:" (U'L'U) L (U'L'U) ",s_RUB:" ([BRU])i ",s_RFU:" (F'R) (UR2U') R' (FR) (UR2U') R ",s_FUR:" R2 U' RM'x L2M2 (ULU') R' (UL'U') L'R'U ",s_RBD:" R'UR2U'R'F'RUR2U'R'F ",s_BDR:" RUR' DL2 x2 U'RU L2x2 U'D'R ",s_LBU:" (U'L'U) ",s_BUL:" y RUR2U'R' y' ",s_FLU:" R' (ULU') ",s_LUF:" L' (U'L'U) ",s_LFD:" L2 (U'L'U) ",s_FDL:" (U'L'U) L' (U'LU)",s_BLD:" (U'LU) ",s_LDB:" L (U'L'U) "},pieces:{M2:["M2"],R2:["R2"],opposites:{buffers:{edges:["DF","FD","UB","BU"],corners:["DFR","RDF","FRD","UBR","RUB","BRU"]},normals:{edges:["UF","FU","DB","BD"],corners:["URF","FUR","RFU","DRB","BDR","RBD"]}},buffers:{edge:"DF",corner:"DFR"},cube:{U:"U",D:"D",F:"F",B:"B",L:"L",R:"R",DF:"DF",DR:"DR",DB:"DB",DL:"DL",UF:"UF",UR:"UR",UB:"UB",UL:"UL",FR:"FR",BR:"BR",FL:"FL",BL:"BL",DFR:"DFR",DRB:"DRB",DBL:"DBL",DLF:"DLF",URF:"URF",UBR:"UBR",ULB:"ULB",UFL:"UFL"},pieces:["U","D","F","B","L","R","DF","DR","DB","DL","UF","UR","UB","UL","FR","BR","FL","BL","DFR","DRB","DBL","DLF","URF","UBR","ULB","UFL"],faces:{U:["ULB","UB","UBR","UL","U","UR","UFL","UF","URF"],D:["DLF","DF","DFR","DL","D","DR","DBL","DB","DRB"],F:["FLU","FU","FUR","FL","F","FR","FDL","FD","FRD"],B:["BRU","BU","BUL","BR","B","BL","BDR","BD","BLD"],L:["LBU","LU","LUF","LB","L","LF","LDB","LD","LFD"],R:["RFU","RU","RUB","RF","R","RB","RDF","RD","RBD"]},slices:{M:["F","U","B","D","UF","UB","DB","DF"],E:["F","R","B","L","FL","FR","BL","BR"],S:["U","R","D","L","UL","UR","DR","DL"]},axis:{x:["U","F","D","B"],y:["F","L","B","R"],z:["U","R","D","L"]},noUnsetup:["UF","DB","FU","BD","DRB","RBD","BDR","URF","RFU","FUR"]},is:{face:function(a){return/^[udfblr]$/i.test(a)},slice:function(a){return/^[mes]$/i.test(a)},axis:function(a){return/^[xyz]$/i.test(a)},move:function(a){return b.is.face(a)||b.is.slice(a)||b.is.axis(a)},modifier:function(a){return/^[2i'\-\+]$/.test(a)},rotation:function(a){return/^[udfblrmesxyz][2i'\-\+]?$/i.test(a)},median:function(a){return/^([ud][fb]|[fb][ud])$/i.test(a)},pattern:function(a){return/^(o[24][udfb]|o6[lr]|c[cw][23]|pt[jn]|par|prn)$/i.test(a)},piece:function(a){return/^(?:([udfblr])(?!.*\1)){2,3}$/i.test(a)},edge:function(a){return 2==a.length&&b.is.piece(a)},corner:function(a){return 3==a.length&&b.is.piece(a)},buffer:function(a){return b.is.edge(a)&&b.service.targetOf(a)==b.pieces.buffers.edge||b.is.corner(a)&&b.service.targetOf(a)==b.pieces.buffers.corner}},canbe:{negative:function(a){return 1==a.length||"+"==a.charAt(1)||"-"==a.charAt(1)},mirror:function(a){return b.canbe.negative(a)||"2"==a.charAt(1)},accepted:function(a,b,c){var d=!b&&!c||""==b&&""==c;return b&&"string"==typeof b&&(d=1==b.length&&b==a.charAt(0)),b&&b instanceof Array&&(d=b.indexOf(a)>-1),c&&"string"==typeof c&&(d=!(1==c.length&&c==a.charAt(0))),c&&c instanceof Array&&(d=-1==c.indexOf(a)),d}},service:{targetOf:function(a){var c,d,e,f,g,h=a.toUpperCase();return null==b.pieces.cube[h]&&(c=h.indexOf("U"),d=h.indexOf("D"),e=h.indexOf("F"),f=h.indexOf("B"),g=c>-1?c:d>-1?d:e>-1?e:f>-1?f:null,g&&(h=h.substr(g)+h.substr(0,g))),h},moveCounter:function(a,b){var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=Number(a[d]==b));return c},cloneCube:function(a){var c,d={};for(c in b.pieces.cube)b.pieces.cube.hasOwnProperty(c)&&(d[c]=a&&a[c]?a[c]:b.pieces.cube[c]);return d},getPieceFromStickers:function(a,c){var d,e;for(d in c)if(c.hasOwnProperty(d)&&(c[d]==a||c[d]==b.service.rotate(a,-1)||c[d]==b.service.rotate(a,1)))return e=b.service.getRotation(c[d]),b.service.rotate(d,e);return!1},getStickersFromPiece:function(a,c,d){var e,f,g=b.service.targetOf(a),h=c[g],i=[];if(a==g||!d&&b.is.median(a))return h;for(e=0;e<h.length;e++)f=g.indexOf(a.charAt(e)),i.push(h.charAt(f));return i.join("")},getRotation:function(a,c){if(2==a.length)return a!=b.service.targetOf(a);var d=null,e=b.service.targetOf(a);return a==e?d=0:(b.service.rotate(a,1)==e&&(d=c?1:-1),b.service.rotate(a,-1)==e&&(d=c?-1:1)),d},rotate:function(a,b){var c=0===b||2!==a.length&&-1!==b?2:1;return 0===b||b===!1?a:a.substr(c)+a.substr(0,c)},replaceMove:function(a,b,c){var d,e=[];for(d=0;d<a.length;d++)e.push(a[d].charAt(0)==b?c+a[d].substr(1):a[d]);return e},notAcceptedWithPiece:function(a){var c,d=b.pieces.axis,e=b.pieces.faces,f=[];if(a.length>=1){-1==d.x.indexOf(a[0])?c=d.x:-1==d.y.indexOf(a[0])?c=d.y:-1==d.z.indexOf(a[0])&&(c=d.z);for(var g in e)e.hasOwnProperty(g)&&-1==c.indexOf(g)&&f.push(g)}if(a.length>=2){var h="U"==a[0]||"F"==a[0]||"L"==a[0]?1:"D"==a[0]||"B"==a[0]||"R"==a[0]?-1:0,i=c.indexOf(a[1]),j=i+2,k=i+h+2*h;j>=c.length&&(j-=c.length),k>=c.length&&(k-=c.length),0>k&&(k=c.length+k),f.push(a[1]),f.push(c[j]),f.push(c[k])}return 3==a.length&&f.push(a[2]),f}},math:{multiply:function(a,b){var c,d=[];for(c=0;b>c;c++)d=d.concat(a);return d},negative:function(a){var c,d,e=a;return b.canbe.negative(a)&&(c=a.charAt(0),d=1==a.length?"+":a.charAt(1),d=b.math.signInverse(d),e=c+d),e},inverse:function(a){var c=a;return b.canbe.negative(a)&&(c=b.math.negative(a)),c},mirror:function(a,c){c||(c="M");var d,e,f=a;return b.canbe.mirror(a)&&(d=a.charAt(0),d="M"==c?"L"==d?"R":"R"==d?"L":d:d,d="E"==c?"U"==d?"D":"D"==d?"U":d:d,d="S"==c?"F"==d?"B":"B"==d?"F":d:d,e=1==a.length?"+":a.charAt(1),f=b.math.negative(d+e)),f},negativePattern:function(a,c,d){var e,f=[];for(e=0;e<a.length;e++)f.push(b.canbe.accepted(a[e],c,d)?b.math.negative(a[e]):a[e]);return f},inversePattern:function(a,c,d){var e,f=[];for(e=0;e<a.length;e++)f.unshift(b.canbe.accepted(a[e],c,d)?b.math.inverse(a[e]):a[e]);return f},mirrorPattern:function(a,c){var d,e=[];for(d=0;d<a.length;d++)e.push(b.math.mirror(a[d],c));return e},signSum:function(a,b){var c;return"2"==a&&(c="+"==b?"-":"-"==b?"+":null),"-"==a&&(c="2"==b?"+":"-"==b?"2":null),"+"==a&&(c="2"==b?"-":"+"==b?"2":null),c},signInverse:function(a){return"+"==a?"-":"-"==a?"+":a}},expand:{piece:function(a,c){var d,e=null!=b.patterns["s_"+a],f=null!=b.patterns["p_"+a],g=a;return(e||f)&&(g="["+a+"]",e&&c&&-1==b.pieces.noUnsetup.indexOf(a)&&(d=2==a.length?"M2":3==a.length?"R2":"",g=g+d+"("+g+")i")),b.parse.moves(g)},pattern:function(a){var c,d,e,f,g=[],h=[];for(c=0;c<a.length;c++)d=a[c],e=d.charAt(0),f=1==d.length?"+":d.charAt(1),b.is.rotation(d)&&(g=[d]),b.is.pattern(d)&&(g=b.expand.piece(d)),b.is.piece(d)&&(g=b.expand.piece(d,!0)),h=h.concat(g);return h}},parse:{moves:function(a,c,d,e){function f(a){(o?o:s>=0?r[s]:p).push(a)}function g(a){s>-1?r[s]=r[s].concat(a):p=p.concat(a)}function h(){if("("==j&&(r[++s]=[]),")"==j&&(n=r[s],l==Number(l)?n=b.math.multiply(n,Number(l)):"-"==l||"'"==l?n=b.math.negativePattern(n):"m"==l.toLowerCase()?n=b.math.mirrorPattern(n):"i"==l.toLowerCase()&&(n=b.math.inversePattern(n)),s--,g(n),("m"==l.toLowerCase()||"i"==l.toLowerCase())&&(l="")&&(j="")),"["!=j||o||(o=[]),"]"==j&&o){if(o=o.join("").toUpperCase(),b.is.piece(o)||b.is.pattern(o)){var a=b.is.piece(o)?"s_":b.is.pattern(o)?"p_":"",d=b.patterns[a+o];d&&g(b.parse.moves(d))}o=!1}o&&"["!=j?f(j):j&&b.is.move(j)&&(m="2"==l?c?"+":l:"+"==l||"-"==l?l:"i"==l||"'"==l?"-":"+",k=(e&&!o?j:b.clear.adjustCase(j))+m,c&&"2"==l&&f(k),f(k),o||e||j!=j.toLowerCase()||(k=!1,"u"==j?k="E"+m:"d"==j?k="E"+b.math.signInverse(m):"f"==j?k="S"+m:"b"==j?k="S"+b.math.signInverse(m):"l"==j?k="M"+m:"r"==j&&(k="M"+b.math.signInverse(m)),k&&f(k))),j=l}for(var i,j,k,l,m,n,o,p=[],q=b.clear.all(a).split(""),r=[],s=-1,t=0;t<q.length;t++)l=q[t],d||(l=b.clear.adjustCase(l)),h();return h(),i=c?b.clear.uncollapseSequence(p):b.clear.collapseSequence(p)},pieces:function(a,c){for(var d,e,f=[],g=b.clear.pieces(a).split(","),h=0;h<g.length;h++)e=g[h],1==e.length&&(e+="+"),e=b.is.piece(e)||b.is.pattern(e)?e.toUpperCase():b.is.rotation(e)?b.clear.adjustCase(e.charAt(0))+e.charAt(1):null,e&&f.push(e);return f=b.expand.pattern(b.clear.patterns(f)),d=c?b.clear.uncollapseSequence(f):b.clear.collapseSequence(f)}},clear:{all:function(a){return a.replace(/[^udfblrmesxyz2-9i'\-\+\(\)\[\]ocwptjna]+/gi,"")},pieces:function(a){return a=a.replace(/[i']+/gi,"-"),a=a.replace(/[,;\.\n\r ]+/g,","),a=a.replace(/[^udfblrmesxyz2\-\+,ocwptjna346]+/gi,"")},sequence:function(a){return a=a.replace(/[i']+/gi,"-"),a=a.replace(/[^udfblrmesxyz2\-\+]+/gi,"")},patterns:function(a){var c,d,e=[];for(d=0;d<a.length;d++)c=a[d],(b.is.piece(c)||b.is.rotation(c)||b.is.pattern(c))&&e.push(c);return e},adjustCase:function(a){return b.is.face(a)||b.is.slice(a)?a.toUpperCase():b.is.axis(a)?a.toLowerCase():a},collapseSequence:function(a){var c,d,e,f,g,h,i=[];for(g=0;g<a.length;g++)c=a[g].charAt(0),d=a[g].charAt(1),h=!0,g>0&&c==e&&(i.pop(),d==f?"2"==d?h=!1:d="2":(d=b.math.signSum(f,d),d||(h=!1))),h&&i.push(c+d),e=0==i.length?"":i[i.length-1].charAt(0),f=0==i.length?"":i[i.length-1].charAt(1);return i},uncollapseSequence:function(a){var b,c,d,e=[];for(d=0;d<a.length;d++)b=a[d].charAt(0),c=a[d].charAt(1),"2"==c&&(c="+",e.push(b+c)),e.push(b+c);return e}}}}(),c=function(a){return{solveArray:[],explainArray:[],explainCallback:function(a,b){c.explainArray.push({n:a,v:b})},check:{orientedCube:function(b){var c,d,e;for(d in a.pieces.faces)if(a.pieces.faces.hasOwnProperty(d)&&(e=d,c=a.service.getStickersFromPiece(e,b),e!=c))return alert("Please, correctly orient the cube before solving process."),!1;return!0},correctPieces:function(b){var c,d,e={};for(c in b)if(b.hasOwnProperty(c)){if(d=a.service.targetOf(b[c]),e[d])return alert("Alert! Piece in "+e[d]+" and "+c+" have the same stickers.\nPlease, correct one of those pieces."),!1;e[d]=c}return!0}},service:{freeTarget:function(b,c,d,e){c||(c=1);var f,g,h,i,j,k=e?[]:!1;for(i in b)if(b.hasOwnProperty(i)){if(1==i.length)continue;j=b[i],a.is.median(j)&&(j=d?a.service.targetOf(j):j),f=j!=i&&(1==c||c==i.length),g=!a.is.buffer(i),h=f&&g&&(!k||e||a.expand.piece(k,!0).length>a.expand.piece(i,!0).length),h&&(e?k.push(i):k=i)}return k},opposite:function(b,d){var e=d?"buffers":"normals",f=a.pieces.opposites[e].edges.indexOf(b),g=a.pieces.opposites[e].corners.indexOf(b),h=[b],i=0;return f>-1&&(i=f+2,h=a.pieces.opposites[e].edges),g>-1&&(i=g+3,h=a.pieces.opposites[e].corners),i>=h.length&&(i-=h.length),f>-1&&(d||c.explainCallback("PIECES_CYCLE_OPPOSITE_MEDIAN_EDGES",[b,h[i]])),g>-1&&(d||c.explainCallback("PIECES_CYCLE_OPPOSITE_RIGHT_CORNERS",[b,h[i]])),h[i]}},solve:{explain:function(a){return c.explainArray=[],c.solveArray=c.solve.full(a,0),{s:c.solveArray,e:c.explainArray}},full:function(b,d){if((!d||0>d||d>3)&&(d=0),!c.check.orientedCube(b))return[];if(!c.check.correctPieces(b))return[];c.explainCallback("BEGIN");var e=c.solve.edgesUnoriented(b);e=e.concat(c.solve.pieces(b,a.pieces.buffers.edge,a.pieces.M2));var f=c.solve.pieces(b,a.pieces.buffers.corner,a.pieces.R2),g=Boolean(a.service.moveCounter(e,a.pieces.M2)%2),h=Boolean(a.service.moveCounter(f,a.pieces.R2)%2);g!=h&&console.warn("WARNING: this case is not handled!! parity happened only on edges or corners..",b);var i=e.concat(f);c.explainCallback("END",[i.toString()]);var j=a.expand.pattern(i),k=a.clear.collapseSequence(j),l=a.clear.uncollapseSequence(j),m=a.math.inversePattern(k);return 0==d?i:1==d?l:2==d?k:3==d?m:[]},pieces:function(b,d,e){function f(e,f,g){var h=a.service.targetOf(e);if(a.is.median(e)&&(g||h!=d)){var i=a.service.getPieceFromStickers(e,b);c.explainCallback("PIECES_EDGES_BEGIN",e);var j=i!=a.service.targetOf(i);j||c.explainCallback("PIECES_EDGES_FLIPPED_STATE",[e,j]);var k=f&&a.service.getRotation(f)&&!a.is.median(f);k&&(j=!j),g&&(j=r),k&&c.explainCallback("PIECES_EDGES_PREVIOUS_FLIPPED",[e,f]),g&&r&&c.explainCallback("PIECES_EDGES_BUFFER_FLIPPED",e),j&&-1==n.indexOf(h)&&(n.push(h),c.explainCallback("PIECES_EDGES_ADD_TO_FLIPPED",[e,n.toString()])),c.explainCallback("END_VOID")}}function g(b){var d=q?c.service.opposite(j):j;b?(u=h,c.explainCallback("MEMORIZE_PLACEHOLDER",h)):c.explainCallback("MEMORIZE_PIECE",d),m.push(d),k=a.service.getStickersFromPiece(j,i),q=!q,i[h]=h,j!=k&&(c.explainCallback("PIECES_CYCLE_CHECK_NEXT_PIECE",[j,k]),o&&f.call(this,k,j))}var h,i=a.service.cloneCube(b),j=d,k=i[d],l=!k,m=[],n=[],o=a.is.edge(d),p=a.is.corner(d);c.explainCallback("PIECES_BEGIN",(o?"edges":p?"corners":"").toUpperCase());var q=!1,r=!1,s=!1,t=!1,u=!1;for(c.explainCallback("PIECES_CYCLE_BEGIN"),c.explainCallback("PIECES_CYCLE_EXAMINE_BUFFER",d),c.explainCallback("PIECES_CYCLE_CHECK_BUFFER_POSITION",k),o&&f.call(this,k),c.explainCallback("END_VOID");!l;){if(c.explainCallback("PIECES_CYCLE_EXAMINE_PIECE",k),j=k,h=a.service.targetOf(j),t=a.is.buffer(j),t&&c.explainCallback("PIECES_CYCLE_BUFFER_FOUND",[j,j!=h]),r=t?j!=h:h!=u||j==h||a.is.median(j)?r:!r,t||h!=u||(u=!1,t=!0,c.explainCallback("PIECES_CYCLE_PLACEHOLDER_FOUND",[j,j!=h&&!a.is.median(j)]),o&&j!=h&&c.explainCallback("PIECES_CYCLE_EDGE_IS_FLIPPED",[j,a.is.median(j)]),g.call(this)),t)if(s=c.service.freeTarget(i,j.length),c.explainCallback("PIECES_CYCLE_CHECK_FREE_TARGET",s.toString()),s!==!1)j=s,h=s,g.call(this,!0);else{if(c.explainCallback("PIECES_CYCLE_ALL_IS_OK"),o&&f.call(this,d,!1,!0),q){if(c.explainCallback("PIECES_PARITY_BEGIN"),c.explainCallback("MEMORIZE_MIDDLE",[o?"M-slice":"R-face",e]),m=m.concat(e),o){if(n.length>0){for(var v in n)n[v]=c.service.opposite(n[v],!0);c.explainCallback("PIECES_PARITY_SWITCH_FLIPPED_MEDIANS",n.toString())}}else c.explainCallback("MEMORIZE_PARITY","PAR"),m=m.concat(["PAR"]);c.explainCallback("END_VOID")}if(o){var w=c.solve.mEdgesUnoriented(n);m=m.concat(w),w.length>0&&c.explainCallback("MEMORIZE_ORIENT_EDGES",w.toString())}l=!0}else g.call(this);c.explainCallback("END_VOID")}return c.explainCallback("END_VOID"),c.explainCallback("PIECES_END",[(o?"edges":p?"corners":"").toUpperCase(),m.toString()]),m},edgesUnoriented:function(){c.explainCallback("UNORIENTED_BEGIN");var a=[];return c.explainCallback("UNORIENTED_WIP"),c.explainCallback("UNORIENTED_END",[a.toString()]),a},mEdgesUnoriented:function(a){var b,c,d,e,f,g,h=[];return(1==a.length||3==a.length||a.length>4)&&console.error("ERROR: wrong array of flipped M-edges: ",a),4==a.length&&(h=["O2U","O2D"]),2==a.length&&(d=a[0].charAt(0),e=a[0].charAt(1),a[1].indexOf(d)>-1&&(c=d),a[1].indexOf(e)>-1&&(c=e),c?h=["O2"+c]:(f=a[0].indexOf("D"),g=a[1].indexOf("D"),f>-1&&(b=Number(!f),c=a[0].charAt(b)),g>-1&&(b=Number(!g),c=a[1].charAt(b)),c&&(h=[c+"2","O2U",c+"2"]))),h}}}}(b),d=function(){var a={TITLE:{p:0,g:0,m:"* SOLVE PROCESS *"},BEGIN:{p:0,g:1,m:"begin memorizing"},END:{p:0,g:-1,m:"end memorizing [%s]"},BEGIN_VOID:{p:3,g:1,m:""},END_VOID:{p:3,g:-1,m:""},UNORIENTED_BEGIN:{p:3,g:1,m:"solve unoriented edges"},UNORIENTED_END:{p:3,g:-1,m:"unoriented pieces: [%s]"},UNORIENTED_WIP:{p:3,g:0,m:"method not yet implemented. will return an empty array."},PIECES_BEGIN:{p:3,g:1,m:"solve unpermuted/unoriented %s"},PIECES_END:{p:1,g:-1,m:"done with %s: [%s]"},PIECES_CYCLE_BEGIN:{p:3,g:1,m:"piece-finding cycle"},PIECES_CYCLE_EXAMINE_BUFFER:{p:3,g:1,m:"examine the buffer [%s]"},PIECES_CYCLE_EXAMINE_PIECE:{p:3,g:1,m:"examine the piece [%s]"},PIECES_CYCLE_CHECK_BUFFER:{p:1,g:0,m:"first thing first: examine the buffer piece: [%s]"},PIECES_CYCLE_BUFFER_FOUND:{p:2,g:0,m:"the piece [%s] is the buffer - flipState: %s"},PIECES_CYCLE_PLACEHOLDER_FOUND:{p:2,g:0,m:"the piece in [%s] position is the buffer - should invert flipState? %s"},PIECES_CYCLE_CHECK_FREE_TARGET:{p:1,g:0,m:"check for the first target to be solved: [%s]"},PIECES_CYCLE_ALL_IS_OK:{p:2,g:0,m:"all pieces are correctly permuted"},PIECES_CYCLE_CHECK_BUFFER_FLIP:{p:1,g:0,m:"check if edge buffer is flipped after all iterations"},PIECES_CYCLE_EDGE_IS_FLIPPED:{p:2,g:0,m:"note that the edge [%s] is flipped - is median? %s"},PIECES_CYCLE_BUFFER_FLIP_STATE:{p:1,g:0,m:"remember to %s the flip state of buffer piece when edges are finished"},PIECES_CYCLE_OPPOSITE_MEDIAN_EDGES:{p:2,g:0,m:"the M-slice is rotated, so switch DB with UF or viceversa: [%s] -> [%s]"},PIECES_CYCLE_OPPOSITE_RIGHT_CORNERS:{p:2,g:0,m:"the R-face is rotated, so switch DRB with URF or viceversa: [%s] -> [%s]"},PIECES_CYCLE_CHECK_NEXT_PIECE:{p:2,g:0,m:"look at the piece in [%s] position: [%s]"},PIECES_CYCLE_CHECK_BUFFER_POSITION:{p:2,g:0,m:"look at the piece in buffer position: [%s]"},PIECES_EDGES_BEGIN:{p:3,g:1,m:"check for flipped median edge [%s]"},PIECES_EDGES_FLIPPED_STATE:{p:2,g:0,m:"flipped state of piece [%s] : %s"},PIECES_EDGES_PREVIOUS_FLIPPED:{p:1,g:0,m:"invert flipped state of [%s] because previous piece [%s] was unoriented"},PIECES_EDGES_BUFFER_FLIPPED:{p:2,g:0,m:"invert flipped state of buffer [%s]"},PIECES_EDGES_ADD_TO_FLIPPED:{p:1,g:0,m:"edge [%s] is flipped, add it to the flipped edge list: [%s]"},PIECES_EDGES_DONT_CHECK_BUFFER:{p:2,g:0,m:"is not the time to check the buffer [%s] flip state"},PIECES_EDGES_IS_MEDIAN:{p:2,g:0,m:"the piece [%s] is part of median slice"},PIECES_EDGES_CHECK_ONLY_MEDIAN:{p:2,g:0,m:"the piece [%s] is not part of median slice"},PIECES_PARITY_BEGIN:{p:3,g:1,m:"parity occurred!"},PIECES_PARITY_SWITCH_FLIPPED_MEDIANS:{p:2,g:0,m:"switch DF with UB and viceversa in the list of flipped edges: [%s]"},MEMORIZE_MIDDLE:{p:0,g:0,m:"** the %s is rotated, for now rotate it back with [%s]"},MEMORIZE_PARITY:{p:0,g:0,m:"** finally do the parity pattern: [%s]"},MEMORIZE_PIECE:{p:0,g:0,m:"** memorize the piece: [%s]"},MEMORIZE_PLACEHOLDER:{p:0,g:0,m:"** memorize the buffer placeholder position: [%s]"},MEMORIZE_ORIENT_EDGES:{p:0,g:0,m:"** memorize the sequence for correctly orient the median edges: [%s]"}};return{constants:a,explain:function(a,b){var c=0,d=0,e=a,f=this.constants[a];

f&&(c=f.p,d=f.g,e=f.m);var g,h,i;if(e){if(g=e,b)if("string"==typeof b)g=e.replace(/%s/g,b);else{i=e.split("%s");for(h in i)i.hasOwnProperty(h)&&null!=b[h]&&(i[h]=i[h]+b[h]);g=i.join("")}}else d=-1;return{m:g,g:d,p:c}},explainAll:function(a,b){for(var c,d=[],e=0;e<a.length;e++)c=this.explain(a[e].n,a[e].v),b&&this._speak(c.m,c.g,c.p),d.push(c);return d},_speak:function(a,b,c){if(console&&console.log&&console.group&&console.groupCollapsed&&console.groupEnd&&(this.options.explainPriority<0||this.options.explainPriority>=c)){var d=!0,e=d?console.groupCollapsed:console.group;b>0&&a&&e(a),0>=b&&a&&console.log(a),0>b&&console.groupEnd()}}}}(),e=function(a,b){function c(c,d){if(this.$el=a("#"+c),0==this.$el.length)throw new Error("rubik cube not drawn: given ID does not exists in dom");this._options={pieceSize:30,showAxis:!1},this._currentCube=b.service.cloneCube(b.pieces.cube),a.extend(this._options,d)}function d(){return b.service.cloneCube(this._currentCube)}function e(a){this._currentCube=b.service.cloneCube(a),this.render()}function f(b,c){function f(b){a.extend(i,k.rotatedPieces(b)),e.call(k,i)}function g(){b.length>0&&setTimeout(function(){f(b[j++]),j<b.length&&g()},c)}var h,i=d.call(this),j=0,k=this;if(c)g();else for(h=0;h<b.length;h++)f(b[h])}function g(a,c){this._currentCube[b.service.targetOf(a)]=b.service.rotate(c,b.service.getRotation(a,!0)),this.render()}return c.prototype={willRender:function(){},didRender:function(){},render:function(){this.willRender(),this.didRender()},getCube:function(){return d.call(this)},setCube:function(a){e.call(this,a)},execute:function(a,b){f.call(this,a,b)},getPiece:function(a){return b.service.getStickersFromPiece(a,this._currentCube,!0)},setPiece:function(a,b){g.call(this,a,b)},updateColors:function(c){a.extend(b.colors,c),this.render()},axisRotation:function(a){var b=a.charAt(0),c=a.charAt(1),d="-"==c?-1:1,e="L"==b||"M"==b?-1:"R"==b?1:0,f="U"==b||"E"==b?-1:"D"==b?1:0,g="F"==b||"S"==b?-1:"B"==b?1:0;e=("x"==b?1:e)*d,f=("y"==b?-1:f)*d,g=("z"==b?-1:g)*d;var h=0!=e?"x":0!=f?"y":0!=g?"z":b,i=e>0||f>0||g>0?"+":0>e||0>f||0>g?"-":c;return h+i},rotatedPieces:function(a){var c={};if(a){var d,e,f,g=a.charAt(0),h=null;!h&&null!=b.pieces.axis[g]&&(h=b.pieces.pieces),!h&&null!=b.pieces.slices[g]&&(h=b.pieces.slices[g]),!h&&null!=b.pieces.faces[g]&&(h=b.pieces.faces[g]);for(d in h)h.hasOwnProperty(d)&&(e=b.service.targetOf(h[d]),f=this.orientedPiece(e,a),c[e]=b.service.getStickersFromPiece(f,this._currentCube,!0))}return c},orientedPiece:function(a,c){var d,e,f,g,h=this.axisRotation(c),i=b.pieces.axis[h.charAt(0)],j="-"==h.charAt(1)?-1:1,k=a.split(""),l=[];for(d=0;d<k.length;d++)g=k[d],e=i.indexOf(g),-1==e?l.push(g):(f=e+j,f=0>f?i.length-1:f>=i.length?0:f,l.push(i[f]));return l.join("")}},c}(jQuery,b),f=function(a,b,c){function d(a,c){b.call(this,a,c),this._renderOptions={order:["DBL","DB","DRB","DL","D","DR","DLF","DF","DFR","BL","B","BR","L","R","FL","F","FR","ULB","UB","UBR","UL","U","UR","UFL","UF","URF"],backfaces:!1,highlights:[],highlightColored:!1},this.iso={container:this.$el,engine:new l},this.iso.engine.init(this.iso.container,{worldSizeWidth:400,worldSizeHeight:300}),this.iso.layer=this.iso.engine.addLayer("cube",!0),this.iso.console=this.iso.engine.addLayer("console");var d=this.iso.console.addChild(new p("cubeletInfo"));d._position=new m(-200,120),d.setFont("Open Sans",20),this.render()}function e(a){this._renderOptions.backfaces=null!=a?a:!this._renderOptions.backfaces,this.render()}function f(b){var c=[];b&&b.forEach(function(b){c.push(a.service.targetOf(b))}.bind(this)),this._renderOptions.highlights=c,this.render()}function g(b,c,d,e){c||(c=b);for(var f,g,j=this._options.pieceSize,k=new m(-j/2,-j/2,-j/2),l=[],n=[b.indexOf("U"),b.indexOf("R"),b.indexOf("F"),b.indexOf("D"),b.indexOf("B"),b.indexOf("L")],o=0;o<n.length;o++)f=-1==n[o]?null:c.charAt(n[o]),(!e||o>=3)&&(g={name:f,color:f?d?a.colors[c]:a.colors[f]:null}),l.push(g);var p=-1!=b.indexOf("D")?-1:-1!=b.indexOf("U")?1:0,q=-1!=b.indexOf("F")?1:-1!=b.indexOf("B")?-1:0,r=-1!=b.indexOf("L")?-1:-1!=b.indexOf("R")?1:0,s=!0;this.iso.layer._children["_piece_"+b]||h.call(this,b,k.add(new m(j*r,j*q,j*p)),j,s),i.call(this,b,c,j,{fills:l,stroke:a.colors.core},s)}function h(a,b,c,d){var e=new n("_piece_"+a);e.set("position",a),d&&(e.addChild(new o("_face_D")).set("position","D")._position=b.add(new m(0,0,0)),e.addChild(new o("_face_B")).set("position","B")._position=b.add(new m(0,0,0)),e.addChild(new o("_face_L")).set("position","L")._position=b.add(new m(0,0,0))),e.addChild(new o("_face_U")).set("position","U")._position=b.add(new m(0,0,c)),e.addChild(new o("_face_R")).set("position","R")._position=b.add(new m(c,0,0)),e.addChild(new o("_face_F")).set("position","F")._position=b.add(new m(0,c,0)),this.iso.layer.addChild(e)}function i(a,b,c,d,e){var f=this.iso.layer._children["_piece_"+a];if(f){f.set("sticker",b);var g=d.fills.map(function(a){return a&&a.name}),h={fills:d.fills.map(function(a){return a&&a.color}),color:d.stroke};e&&h.fills&&6==h.fills.length&&(j.call(this,f._children._face_D,k(g,3),"get3DPolygonSquare",c,h.fills?k(h.fills,3):null,h.color),j.call(this,f._children._face_B,k(g,4),"get3DPolygonSquareLeft",c,h.fills?k(h.fills,4):null,h.color),j.call(this,f._children._face_L,k(g,5),"get3DPolygonSquareRight",c,h.fills?k(h.fills,5):null,h.color)),j.call(this,f._children._face_U,k(g,0),"get3DPolygonSquare",c,h.fills?k(h.fills,0):null,h.color),j.call(this,f._children._face_R,k(g,1),"get3DPolygonSquareRight",c,h.fills?k(h.fills,1):null,h.color),j.call(this,f._children._face_F,k(g,2),"get3DPolygonSquareLeft",c,h.fills?k(h.fills,2):null,h.color)}}function j(a,b,c,d,e,f){e?a.setRenderInfo(this.iso.engine.drawUtils[c](d),{strokeColor:null==e?null:f,fillColor:e,strokeSize:1}):a.setRenderInfo(null),a.set("sticker",b)}function k(a,b){return a.length>b?a[b]:a[a.length-1]}var l=c.core.Engine,m=c.core.Point,n=c.display.Sprite,o=c.display.Shape,p=c.display.Text;return d.prototype=Object.create(b.prototype),d.prototype.willRender=function(){},d.prototype.didRender=function(){this.iso.layer._render(),this._options.showAxis&&this.iso.engine.drawUtils.axis(this.iso.layer,200)},d.prototype.render=function(a){var b,c=this._renderOptions.highlights,d=this._renderOptions.highlightColored;return this.willRender(),this._renderOptions.order.forEach(function(e){0==c.length?(b=this._currentCube[e],(!a||a.indexOf(e)>-1)&&g.call(this,e,b,!1,this._renderOptions.backfaces)):(b=c.indexOf(e)>-1?d?this._currentCube[e]:"light":"grey",g.call(this,e,b,"grey"==b||"light"==b,this._renderOptions.backfaces))}.bind(this)),this.didRender(),!0},d.prototype.getImage=function(){return this.iso.layer.getCanvas().toDataURL()},d.prototype.backfaceState=function(){return this._renderOptions.backfaces},d.prototype.backfaceToggle=function(a){e.call(this,a)},d.prototype.highlight=function(a){f.call(this,a)},d.prototype.highlightColor=function(a){this._renderOptions.highlightColored=a,this.render()},d}(b,e,a),g=function(a,b,c,d,e){var f={};return f.cube={},f.cube.RubikCube=a,f.cube.RubikCubeIso=b,f["static"]={},f["static"].RubikSolver=c,f["static"].RubikTeacher=d,f["static"].RubikUtils=e,f}(e,f,c,d,b);return g}();