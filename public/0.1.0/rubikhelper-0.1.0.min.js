/*! RubikHelper - v0.1.0 - 2015-04-23 */
var RubikCubeIso=function(){var a=function(){var a=function(){function a(){this._attributes={}}return a.prototype={set:function(a,b){return this._attributes[a]=b,this},get:function(a){return this._attributes[a]},_extend:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]&&a[c]instanceof Object&&!(a[c]instanceof Array)?this._extend(a[c],b[c]):a[c]=b[c])}},a}(),b=function(){function a(a,b,c){this.x=parseFloat(a)||0,this.y=parseFloat(b)||0,this.z=parseFloat(c)||0}return a.prototype={toOrtho:function(){return new a(this.x-this.y,(this.x+this.y)/2-1.25*this.z,0)},toIso:function(){return new a(this.y+this.x/2,this.y-this.x/2,0)},toString:function(){return"{x:"+this.x+", y:"+this.y+", z:"+this.z+"}"},toObject:function(){return{x:this.x,y:this.y,z:this.z}},toArray:function(){return[this.x,this.y,this.z]},add:function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z)},subtract:function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)},multiply:function(b){return new a(this.x*b.x,this.y*b.y,this.z*b.z)},distance:function(a){var b=Math.abs(this.x-a.x),c=Math.abs(this.y-a.y),d=Math.abs(this.z-a.z),e=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));return Math.sqrt(Math.pow(e,2)+Math.pow(d,2))}},a}(),c=function(){function a(a){this._stepCallback=null,this._animation=null,this._startTime=0,a&&this.setCallback(a),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()}return a.prototype={setCallback:function(a){this._stepCallback=a},start:function(a){this._startTime=(new Date).getTime(),this._animate(),a&&setTimeout(function(){this.stop()}.bind(this),a)},stop:function(){cancelRequestAnimFrame(this._animation),this._animation=null},_animate:function(){this._stepRender(),this._animation=requestAnimFrame(this._animate.bind(this))},_stepRender:function(){var a=(new Date).getTime()-this._startTime;this._stepCallback&&this._stepCallback(a)}},a}(),d=function(){function a(a){this.context=a,this.message=null,this.messageOrigin={x:0,y:0},this.isPath=!1,this.isStroke=!1}return a.prototype={setup:function(a){a||(a={});var b=null==a.fillColor?null:this.castToColor(a.fillColor),c=null==a.strokeColor?null:this.castToColor(a.strokeColor),d=a.strokeSize;this.context.restore(),this.context.fillStyle=b,this.context.strokeStyle=c,this.context.lineWidth=d,this.context.globalAlpha=a.alpha||1,this.context.font=a.font||"20px Open Sans",this.context.save(),this.isStroke=null!=c,this.isPath=null!=b,this.isPath&&this.context.beginPath()},render:function(){this.message&&(this.isPath&&this.context.fillText(this.message,this.messageOrigin.x,this.messageOrigin.y),this.isStroke&&this.context.strokeText(this.message,this.messageOrigin.x,this.messageOrigin.y),this.message=null),this.isPath&&this.context.closePath(),this.isPath&&this.context.fill(),this.isPath=!1,this.isStroke&&this.context.stroke(),this.isStroke=!1},moveTo:function(a,b){var c=this.isPath||this.isStroke;return c&&this.context.moveTo(a,b),c},lineTo:function(a,b){var c=this.isPath||this.isStroke;return c&&this.context.lineTo(a,b),c},text:function(a,b){if(!a)return[];b||(b=[0,0]),b=this.castToPoint(b),this.messageOrigin=b,this.message=a;var c=this.context.measureText(a),d=this.context.font,e=Math.ceil(c.width),f=parseInt(d);return isNaN(f)&&(d=d.substr(d.indexOf(" ")),f=parseInt(d)),[b.add([0,0]),b.add([e,0]),b.add([e,-f]),b.add([0,-f])]},line:function(a,b,c){return a&&b?(a=this.castToPoint(a),b=this.castToPoint(b),c&&(a=a.toOrtho(),b=b.toOrtho()),this.moveTo(a.x,a.y)&&this.lineTo(b.x,b.y)):!1},polygon:function(a,b,c){if(!a)return[];b||(b=[0,0,0]),b=this.castToPoint(b),a=a.map(function(a){return this.castToPoint(a)}.bind(this)),c&&(b=b.toOrtho()),c&&(a=a.map(function(a){return a.toOrtho()}));var d,e,f=b.add(a[0]),g=[];for(this.moveTo(f.x,f.y)&&g.push(f),d=1;d<a.length;d++)e=b.add(a[d]),this.lineTo(e.x,e.y)&&g.push(e);return this.lineTo(f.x,f.y),g},castToColor:function(a){var b="string"==typeof a?a:"number"==typeof a?a.toString(16):null;return null!=b&&"#"==b.substr(0,1)&&(b=b.substr(1)),null!=b&&(b="#"+("00000"+b).substr(-6)),b},castToPoint:function(a){var c;return a instanceof b?c=a:"object"==typeof a&&null!=a.x&&null!=a.y?c=new b(parseFloat(a.x),parseFloat(a.y),parseFloat(a.z)):"object"==typeof a&&a.length>1&&a.length<4&&(c=new b(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),c}},a}(),e=function(a,b){function c(c){if(!c)throw new Error('no "name" provided for this displayObject:',this);if(a.call(this),this._name=c,this._parent=null,this._zIndex=0,this._position=new b,this._shape=null,this._info={stepCallback:null,renderMethod:null,renderInfo:null},this._options={strokeColor:0,fillColor:0,strokeSize:1,alpha:1,font:"14px Arial"},this[c])throw new Error('property "%s" already exists on',c,this)}return c.prototype=Object.create(a.prototype),c.prototype.setOptions=function(a){return a?(this._extend(this._options,a),!0):!1},c.prototype.setRenderInfo=function(a,b){b&&this.setOptions(b),this._info.renderInfo=a},c.prototype.setAnimationStep=function(a){this._info.stepCallback=a},c.prototype._addTo=function(a,b){this._zIndex=b||0,this._parent=a},c.prototype._remove=function(){delete this},c.prototype._render=function(a){if(!this._info.renderMethod)throw new Error("no renderMethod set for this instance of DisplayObject: ",this);return this._info.renderInfo?(a._info.draw.setup(this._options),this._shape=a.draw[this._info.renderMethod](this._info.renderInfo,this._position),a._info.draw.render(),!0):!1},c.prototype._step=function(a){return this._info.stepCallback&&this._info.stepCallback(a),!0},c}(a,b),f=function(a){function b(b){a.call(this,b),this._info.renderMethod="image"}return b.prototype=Object.create(a.prototype),b.prototype.render=function(){},b}(e),g=function(a){function b(b){a.call(this,b),this._options.font=this.getFont("Verdana",14),this._options.fillColor=0,this._options.strokeColor=null,this._info.renderMethod="text"}return b.prototype=Object.create(a.prototype),b.prototype.getFont=function(a,b,c){return a?(c||(c=""),b||(b=""),"number"==typeof b&&(b+="px"),[c,b,a].join(" ")):""},b.prototype.setFont=function(a,b,c){return a?(this._options.font=this.getFont(a,b,c),!0):!1},b}(e),h=function(a){function b(b){a.call(this,b),this._options.fillColor=null,this._options.strokeColor=0,this._info.renderMethod="polygon"}return b.prototype=Object.create(a.prototype),b}(e),i=function(a){function b(b){a.call(this,b),this._children={},this._childrenLength=function(){var a=0;return c(this,function(){a++}),a}.bind(this._children),this._childrenArray=function(){var a=[];return c(this,function(b){a.push(b)}),a.sort(function(a,b){return a._zIndex-b._zIndex})}.bind(this._children)}function c(a,b){if(a&&b)for(var c in a)a.hasOwnProperty(c)&&b(a[c])}return b.prototype=Object.create(a.prototype),b.prototype._render=function(a){this._childrenArray(!0).forEach(function(b){b._render(a)})},b.prototype._step=function(b){return this._childrenArray(!0).forEach(function(a){a._step(b)}),a.prototype._step.call(this,b),!0},b.prototype.addChild=function(b,c){if(!(b instanceof a))throw new Error("adding child with unsupported type:",typeof b);if(this[b._name])throw new Error('property "',b._name,'" already exists on',this);return c||(c=this._childrenLength()),this._children[b._name]=b,this[b._name]=b,b._addTo(this,c),this._reorderChildren(),b},b.prototype.removeChild=function(b){b instanceof String&&(b=this[b]),b&&this[b._name]&&this[b._name]instanceof a&&(delete this._children[b._name],delete this[b._name],b._remove())},b.prototype._reorderChildren=function(){this._childrenArray().forEach(function(a,b){a._info.index=b})},b.prototype._getShapes=function(){for(var a,c=[],d=0;d<this._children.length;d++)a=this._children[d],a._shape&&c.push(a._shape),a instanceof b&&(c=c.concat(a._getShapes()));return c},b.prototype._getShapesWithObjects=function(){for(var a,c=[],d=0;d<this._children.length;d++)a=this._children[d],a._shape&&c.push(a),a instanceof b&&(c=c.concat(a._getShapesWithObjects()));return c},b}(e),j=function(a,b){function e(e){b.call(this,"_stage_"+e),this._engine=null,this._info.size={w:0,h:0},this._info.canvas=document.createElement("canvas"),this._info.context=this._info.canvas.getContext("2d"),this._info.draw=new d(this._info.context),this._info.animator=new c(this.renderTime.bind(this)),this.$el=a("<div/>").addClass("iso-layer").css({position:"absolute",top:0,left:0}).append(this._info.canvas)}return e.prototype=Object.create(b.prototype),e.prototype._render=function(){this.clear(),b.prototype._render.call(this,this)},e.prototype._remove=function(){this.$el.remove()},e.prototype._addTo=function(a){if(a){var b=a.worldSize();this.setSize(b.w,b.h),this.$el.appendTo(a.$el),this._engine=a}},e.prototype.clear=function(){this._info.context.clearRect(-this._info.size.w/2,-this._info.size.h/2,this._info.size.w,this._info.size.h)},e.prototype.getCanvas=function(){return this._info.canvas},e.prototype.renderTime=function(a){this._step(a)&&this._render()},e.prototype.startAnimation=function(a){this._info.animator.start(a)},e.prototype.stopAnimation=function(){this._info.animator.stop()},e.prototype.setSize=function(a,b){this._info.size={w:a,h:b},this._info.canvas.width=a.toString(),this._info.canvas.height=b.toString(),this._info.context.translate(a/2,b/2)},e.prototype.setShadow=function(a,b,c,d){this._info.context.shadowColor=a||"#999",this._info.context.shadowBlur=b||20,this._info.context.shadowOffsetX=c||15,this._info.context.shadowOffsetY=d||c||15},e}(jQuery,i),k=function(a){function b(b){a.call(this,b)}return b.prototype=Object.create(a.prototype),b}(i),l=function(a,b,c,d,e,f,g,h,i,j,k){var l={};return l.core={},l.core.ObjectModel=a,l.core.Point=b,l.display={},l.display.Bitmap=c,l.display.DisplayObject=d,l.display.DisplayObjectContainer=e,l.display.Shape=f,l.display.Sprite=g,l.display.Stage=h,l.display.Text=i,l.utils={},l.utils.Animator=j,l.utils.Draw=k,l}(a,b,f,e,i,h,k,j,g,c,d),m=function(a,b,c){function d(){this.$el=a("<div/>"),this.layers={},this.fpsInterval=null,this.fpsLogInterval=null,this.utils={worldSizeWidth:400,worldSizeHeight:400}}function e(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c}return d.prototype={packages:b,init:function(b,c){if(!b)throw new Error('no "elem" param passed to new GraphicEngine instance');c&&a.extend(!0,this.utils,c),this.setWorld(b)},setWorld:function(b){if(this.$el){var c=this.worldSize();this.$el.css("position","relative").width(c.w).height(c.h).appendTo(a(b))}},worldSize:function(){return{w:this.utils.worldSizeWidth,h:this.utils.worldSizeHeight}},render:function(){for(var a in this.layers)this.layers.hasOwnProperty(a)&&this.layers[a].render()},addLayer:function(a){var b=new c(a);return b._addTo(this),this.layers[a]=b,b},removeLayer:function(a){var b=this.layers[a];return b?(b.remove(),delete this.layers[a],!0):!1},showFPS:function(a){a||(a=console.log);var b=0;this.fpsInterval=setInterval(function(){b++},1),this.fpsLogInterval=setInterval(function(){a(b/10),b=0},1e3)},hideFPS:function(){clearInterval(this.fpsInterval),clearInterval(this.fpsLogInterval)},screenToWorld:function(a,b){var c=this.worldSize(),d=this.$el.offset();return{x:a-(d.left+c.w/2),y:b-(d.top+c.h/2)}},getObjectsAtScreenCoord:function(a){var b=this.screenToWorld(a.x,a.y),c=[];for(var d in this.layers)this.layers.hasOwnProperty(d)&&(c=c.concat(this.layers[d].getShapesWithObjects()));for(var f=[],g=0;g<c.length;g++)c[g].shape&&e(c[g].shape,b)&&f.push(c[g]);return f.sort(function(a,b){return b.zindex-a.zindex}),f},draw:{grid:function(a,b,c,d,e){if(!a)throw new Error("calling draw method without providing a Stage instance");b||(b=[10,10]),c||(c=10),d||(d={}),d.strokeSize||(d.strokeSize=1),d.strokeColor||(d.strokeColor=0),d.alpha||(d.alpha=.8),a._info.draw.setup(d);for(var f=0;f<=b[0];f++)a._info.draw.line([f*c,0],[f*c,b[0]*c],e);for(var g=0;g<=b[1];g++)a._info.draw.line([0,g*c],[b[1]*c,g*c],e);a._info.draw.render()},line:function(a,b,c,d,e){if(!a)throw new Error("calling draw method without providing a Stage instance");null!=b&&null!=c&&(d&&a._info.draw.setup(d),a._info.draw.line(b,c,e),a._info.draw.render())},axis:function(a,b,c){if(!a)throw new Error("calling draw method without providing a Stage instance");b||(b=100);var d=[b,0,0],e=[0,b,0],f=[0,0,b];a._info.draw.setup({strokeColor:0}),a._info.draw.line([0,0,0],d,c),a._info.draw.line([0,0,0],e,c),a._info.draw.line([0,0,0],f,c),a._info.draw.render()},get3DPolygonSquare:function(a){return[[0,0,0],[a,0,0],[a,a,0],[0,a,0]]},get3DPolygonSquareRight:function(a){return[[0,0,0],[0,a,0],[0,a,a],[0,0,a]]},get3DPolygonSquareLeft:function(a){return[[0,0,0],[0,0,a],[a,0,a],[a,0,0]]}}},d}(jQuery,l,j,b);return m}(),b=function(){var a={colors:{U:"#ffff00",D:"#ffffff",F:"#ff0000",B:"#ffaa00",L:"#0000ff",R:"#008800",light:"#ffff00",grey:"#cccccc",core:"#222222"},patterns:{p_O4E:" (M'U)4   (MU)4 ",p_O2U:" (M'U)3 U (MU)3 U ",p_O2D:" (M'D)3 D (MD)3 D ",p_O2F:" (M'F)3 F (MF)3 F ",p_O2B:" (M'B)3 B (MB)3 B ",p_O6L:" (R'FRU)5 ",p_O6R:" ([O6L])m ",p_CW2:" (U'RU) R' (U'RU) ",p_CC2:" ([CW2])i ",p_CW3:" ((UR)'UR)2 ",p_CC3:" ([CW3])i ",p_PTJ:" (L'U2) LU (L'U2) (RU') L (RU')i ",p_PAR:" (U'F2) [PTJ] (U'F2)i ",s_UB:" ",s_UF:" (U2 M')2 ",s_DB:" ([UF])i ",s_UR:" R'U RU' ",s_DR:" U R RU' ",s_FR:"  URU' ",s_BR:" ([FR])i ",s_UL:" ([UR])m ",s_DL:" ([DR])m ",s_FL:" ([FR])m ",s_BL:" ([BR])m ",s_BU:" [UB] ",s_FU:" [UF] ",s_BD:" [DB] ",s_RU:" x' ([BR])' ",s_RD:" x' ([FR])' ",s_RF:" x' ([DR])' ",s_RB:" x' ([UR])' ",s_LU:" x' (([BR])')m ",s_LD:" x' (([FR])')m ",s_LF:" x' (([DR])')m ",s_LB:" x' (([UR])')m ",s_UBR:" ",s_URF:" U' (R F' RM' U R2 U') (MR' F R U R2') ",s_DRB:" ([URF])i ",s_ULB:" (LU)' (LU)",s_UFL:" L U'L' U [ULB] ",s_DLF:" U' L2 U ",s_DBL:" [DLF] [ULB] ",s_BRU:" (U'L'U) L (U'L'U) ",s_RUB:" ([BRU])i ",s_RFU:" (F'R) (UR2U') R' (FR) (UR2U') R ",s_FUR:" R2 U' RM'x L2M2 (ULU') R' (UL'U') L'R'U ",s_RBD:" R'UR2U'R'F'RUR2U'R'F ",s_BDR:" RUR' DL2 x2 U'RU L2x2 U'D'R ",s_LBU:" (U'L'U) ",s_BUL:" y RUR2U'R' y' ",s_FLU:" R' (ULU') ",s_LUF:" L' (U'L'U) ",s_LFD:" L2 (U'L'U) ",s_FDL:" (U'L'U) L' (U'LU)",s_BLD:" (U'LU) ",s_LDB:" L (U'L'U) "},pieces:{M2:["M2"],R2:["R2"],opposites:{buffers:{edges:["DF","FD","UB","BU"],corners:["DFR","RDF","FRD","UBR","RUB","BRU"]},normals:{edges:["UF","FU","DB","BD"],corners:["URF","FUR","RFU","DRB","BDR","RBD"]}},buffers:{edge:"DF",corner:"DFR"},cube:{U:"U",D:"D",F:"F",B:"B",L:"L",R:"R",DF:"DF",DR:"DR",DB:"DB",DL:"DL",UF:"UF",UR:"UR",UB:"UB",UL:"UL",FR:"FR",BR:"BR",FL:"FL",BL:"BL",DFR:"DFR",DRB:"DRB",DBL:"DBL",DLF:"DLF",URF:"URF",UBR:"UBR",ULB:"ULB",UFL:"UFL"},pieces:["U","D","F","B","L","R","DF","DR","DB","DL","UF","UR","UB","UL","FR","BR","FL","BL","DFR","DRB","DBL","DLF","URF","UBR","ULB","UFL"],faces:{U:["ULB","UB","UBR","UL","U","UR","UFL","UF","URF"],D:["DLF","DF","DFR","DL","D","DR","DBL","DB","DRB"],F:["FLU","FU","FUR","FL","F","FR","FDL","FD","FRD"],B:["BRU","BU","BUL","BR","B","BL","BDR","BD","BLD"],L:["LBU","LU","LUF","LB","L","LF","LDB","LD","LFD"],R:["RFU","RU","RUB","RF","R","RB","RDF","RD","RBD"]},slices:{M:["F","U","B","D","UF","UB","DB","DF"],E:["F","R","B","L","FL","FR","BL","BR"],S:["U","R","D","L","UL","UR","DR","DL"]},axis:{x:["U","F","D","B"],y:["F","L","B","R"],z:["U","R","D","L"]},noUnsetup:["UF","DB","FU","BD","DRB","RBD","BDR","URF","RFU","FUR"]},is:{face:function(a){return/^[udfblr]$/i.test(a)},slice:function(a){return/^[mes]$/i.test(a)},axis:function(a){return/^[xyz]$/i.test(a)},move:function(b){return a.is.face(b)||a.is.slice(b)||a.is.axis(b)},modifier:function(a){return/^[2i'\-\+]$/.test(a)},rotation:function(a){return/^[udfblrmesxyz][2i'\-\+]?$/i.test(a)},median:function(a){return/^([ud][fb]|[fb][ud])$/i.test(a)},pattern:function(a){return/^(o2[udfb]|o4e|o6[lr]|c[cw][23]|ptj|par)$/i.test(a)},piece:function(a){return/^(?:([udfblr])(?!.*\1)){2,3}$/i.test(a)},edge:function(b){return 2==b.length&&a.is.piece(b)},corner:function(b){return 3==b.length&&a.is.piece(b)},buffer:function(b){return a.is.edge(b)&&a.service.targetOf(b)==a.pieces.buffers.edge||a.is.corner(b)&&a.service.targetOf(b)==a.pieces.buffers.corner}},canbe:{negative:function(a){return 1==a.length||"+"==a.charAt(1)||"-"==a.charAt(1)},mirror:function(b){return a.canbe.negative(b)||"2"==b.charAt(1)},accepted:function(a,b,c){var d=!c&&!b||""==c&&""==b;return c&&"string"==typeof c&&(d=1==c.length&&c==a.charAt(0)),c&&c instanceof Array&&(d=c.indexOf(a)>-1),b&&"string"==typeof b&&(d=!(1==b.length&&b==a.charAt(0))),b&&b instanceof Array&&(d=-1==b.indexOf(a)),d}},service:{targetOf:function(b){var c,d,e,f,g,h=b.toUpperCase();return null==a.pieces.cube[h]&&(c=h.indexOf("U"),d=h.indexOf("D"),e=h.indexOf("F"),f=h.indexOf("B"),g=c>-1?c:d>-1?d:e>-1?e:f>-1?f:null,g&&(h=h.substr(g)+h.substr(0,g))),h},moveCounter:function(a,b){var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=Number(a[d]==b));return c},cloneCube:function(b){var c,d={};for(c in a.pieces.cube)a.pieces.cube.hasOwnProperty(c)&&(d[c]=b&&b[c]?b[c]:a.pieces.cube[c]);return d},getPieceFromStickers:function(b,c){var d,e;for(d in c)if(c.hasOwnProperty(d)&&(c[d]==b||c[d]==a.service.rotate(b,-1)||c[d]==a.service.rotate(b,1)))return e=a.service.getRotation(c[d]),a.service.rotate(d,e);return!1},getStickersFromPiece:function(b,c,d){var e,f,g=a.service.targetOf(b),h=c[g],i=[];if(b==g||!d&&a.is.median(b))return h;for(e=0;e<h.length;e++)f=g.indexOf(b.charAt(e)),i.push(h.charAt(f));return i.join("")},getRotation:function(b,c){if(2==b.length)return b!=a.service.targetOf(b);var d=null,e=a.service.targetOf(b);return b==e?d=0:(a.service.rotate(b,1)==e&&(d=c?1:-1),a.service.rotate(b,-1)==e&&(d=c?-1:1)),d},rotate:function(a,b){var c=0===b||2!==a.length&&-1!==b?2:1;return 0===b||b===!1?a:a.substr(c)+a.substr(0,c)},replaceMove:function(a,b,c){var d,e=[];for(d=0;d<a.length;d++)e.push(a[d].charAt(0)==b?c+a[d].substr(1):a[d]);return e},notAcceptedWithPiece:function(b){var c,d=a.pieces.axis,e=a.pieces.faces,f=[];if(b.length>=1){-1==d.x.indexOf(b[0])?c=d.x:-1==d.y.indexOf(b[0])?c=d.y:-1==d.z.indexOf(b[0])&&(c=d.z);for(var g in e)e.hasOwnProperty(g)&&-1==c.indexOf(g)&&f.push(g)}if(b.length>=2){var h="U"==b[0]||"F"==b[0]||"L"==b[0]?1:"D"==b[0]||"B"==b[0]||"R"==b[0]?-1:0,i=c.indexOf(b[1]),j=i+2,k=i+h+2*h;j>=c.length&&(j-=c.length),k>=c.length&&(k-=c.length),0>k&&(k=c.length+k),f.push(b[1]),f.push(c[j]),f.push(c[k])}return 3==b.length&&f.push(b[2]),f}},math:{multiply:function(a,b){var c,d=[];for(c=0;b>c;c++)d=d.concat(a);return d},negative:function(b){var c,d,e=b;return a.canbe.negative(b)&&(c=b.charAt(0),d=1==b.length?"+":b.charAt(1),d=a.math.signInverse(d),e=c+d),e},inverse:function(b){var c=b;return a.canbe.negative(b)&&(c=a.math.negative(b)),c},mirror:function(b,c){c||(c="M");var d,e,f=b;return a.canbe.mirror(b)&&(d=b.charAt(0),d="M"==c?"L"==d?"R":"R"==d?"L":d:d,d="E"==c?"U"==d?"D":"D"==d?"U":d:d,d="S"==c?"F"==d?"B":"B"==d?"F":d:d,e=1==b.length?"+":b.charAt(1),f=a.math.negative(d+e)),f},negativePattern:function(b,c,d){var e,f=[];for(e=0;e<b.length;e++)f.push(a.canbe.accepted(b[e],c,d)?a.math.negative(b[e]):b[e]);return f},inversePattern:function(b,c,d){var e,f=[];for(e=0;e<b.length;e++)f.unshift(a.canbe.accepted(b[e],c,d)?a.math.inverse(b[e]):b[e]);return f},mirrorPattern:function(b,c){var d,e=[];for(d=0;d<b.length;d++)e.push(a.math.mirror(b[d],c));return e},signSum:function(a,b){var c;return"2"==a&&(c="+"==b?"-":"-"==b?"+":null),"-"==a&&(c="2"==b?"+":"-"==b?"2":null),"+"==a&&(c="2"==b?"-":"+"==b?"2":null),c},signInverse:function(a){return"+"==a?"-":"-"==a?"+":a}},expand:{piece:function(b,c){var d,e=null!=a.patterns["s_"+b],f=null!=a.patterns["p_"+b],g=b;return(e||f)&&(g="["+b+"]",e&&c&&-1==a.pieces.noUnsetup.indexOf(b)&&(d=2==b.length?"M2":3==b.length?"R2":"",g=g+d+"("+g+")i")),a.parse.moves(g)},pattern:function(b){var c,d,e,f,g=[],h=[];for(c=0;c<b.length;c++)d=b[c],e=d.charAt(0),f=1==d.length?"+":d.charAt(1),a.is.rotation(d)&&(g=[d]),a.is.pattern(d)&&(g=a.expand.piece(d)),a.is.piece(d)&&(g=a.expand.piece(d,!0)),h=h.concat(g);return h}},parse:{moves:function(b,c,d,e){function f(a){(o?o:s>=0?r[s]:p).push(a)}function g(a){s>-1?r[s]=r[s].concat(a):p=p.concat(a)}function h(){if("("==j&&(r[++s]=[]),")"==j&&(n=r[s],l==Number(l)?n=a.math.multiply(n,Number(l)):"-"==l||"'"==l?n=a.math.negativePattern(n):"m"==l.toLowerCase()?n=a.math.mirrorPattern(n):"i"==l.toLowerCase()&&(n=a.math.inversePattern(n)),s--,g(n),("m"==l.toLowerCase()||"i"==l.toLowerCase())&&(l="")&&(j="")),"["!=j||o||(o=[]),"]"==j&&o){if(o=o.join("").toUpperCase(),a.is.piece(o)||a.is.pattern(o)){var b=a.is.piece(o)?"s_":a.is.pattern(o)?"p_":"",d=a.patterns[b+o];d&&g(a.parse.moves(d))}o=!1}o&&"["!=j?f(j):j&&a.is.move(j)&&(m="2"==l?c?"+":l:"+"==l||"-"==l?l:"i"==l||"'"==l?"-":"+",k=(e&&!o?j:a.clear.adjustCase(j))+m,c&&"2"==l&&f(k),f(k),o||e||j!=j.toLowerCase()||(k=!1,"u"==j?k="E"+m:"d"==j?k="E"+a.math.signInverse(m):"f"==j?k="S"+m:"b"==j?k="S"+a.math.signInverse(m):"l"==j?k="M"+m:"r"==j&&(k="M"+a.math.signInverse(m)),k&&f(k))),j=l}for(var i,j,k,l,m,n,o,p=[],q=a.clear.all(b).split(""),r=[],s=-1,t=0;t<q.length;t++)l=q[t],d||(l=a.clear.adjustCase(l)),h();return h(),i=c?a.clear.uncollapseSequence(p):a.clear.collapseSequence(p)},pieces:function(b,c){for(var d,e,f=[],g=a.clear.pieces(b).split(","),h=0;h<g.length;h++)e=g[h],1==e.length&&(e+="+"),e=a.is.piece(e)||a.is.pattern(e)?e.toUpperCase():a.is.rotation(e)?a.clear.adjustCase(e.charAt(0))+e.charAt(1):null,e&&f.push(e);return f=a.expand.pattern(a.clear.patterns(f)),d=c?a.clear.uncollapseSequence(f):a.clear.collapseSequence(f)}},clear:{all:function(a){return a.replace(/[^udfblrmesxyz2-9i'\-\+\(\)\[\]_oecwptja]+/gi,"")},pieces:function(a){return a=a.replace(/[i']+/gi,"-"),a=a.replace(/[,;\.\n\r ]+/g,","),a=a.replace(/[^udfblrmesxyz2\-\+,_oecwptja346]+/gi,"")},sequence:function(a){return a=a.replace(/[i']+/gi,"-"),a=a.replace(/[^udfblrmesxyz2i'\-\+]+/gi,"")},patterns:function(b){var c,d,e=[];for(d=0;d<b.length;d++)c=b[d],(a.is.piece(c)||a.is.rotation(c)||a.is.pattern(c))&&e.push(c);return e},adjustCase:function(b){return a.is.face(b)||a.is.slice(b)?b.toUpperCase():a.is.axis(b)?b.toLowerCase():b},collapseSequence:function(b){var c,d,e,f,g,h,i=[];for(g=0;g<b.length;g++)c=b[g].charAt(0),d=b[g].charAt(1),h=!0,g>0&&c==e&&(i.pop(),d==f?"2"==d?h=!1:d="2":(d=a.math.signSum(f,d),d||(h=!1))),h&&i.push(c+d),e=0==i.length?"":i[i.length-1].charAt(0),f=0==i.length?"":i[i.length-1].charAt(1);return i},uncollapseSequence:function(a){var b,c,d,e=[];for(d=0;d<a.length;d++)b=a[d].charAt(0),c=a[d].charAt(1),"2"==c&&(c="+",e.push(b+c)),e.push(b+c);return e}}};return a}(),c=function(a,b){function c(c,d){if(this.$el=a("#"+c),0==this.$el.length)throw new Error("rubik cube not drawn: given ID does not exists in dom");this.options={pieceSize:30,showAxis:!1},this.currentCube=b.service.cloneCube(b.pieces.cube),a.extend(this.options,d)}return c.prototype={willRender:function(){},didRender:function(){},render:function(){this.willRender(),this.didRender()},getCube:function(){return this.getObjectFromCube()},setCube:function(a){this.setCubeFromObject(a)},execute:function(a,b){this.setCubeFromSequence(a,b)},getObjectFromCube:function(){return b.service.cloneCube(this.currentCube)},setCubeFromObject:function(a){this.currentCube=b.service.cloneCube(a),this.render()},setCubeFromSequence:function(b,c){function d(b){a.extend(g,i.rotatedPieces(b)),i.setCubeFromObject(g)}function e(){b.length>0&&setTimeout(function(){d(b[h++]),h<b.length&&e()},c)}var f,g=this.getObjectFromCube(),h=0,i=this;if(c)e();else for(f=0;f<b.length;f++)d(b[f])},getPiece:function(a){return b.service.getStickersFromPiece(a,this.currentCube,!0)},setPiece:function(a,b){this.setPieceFromStickers(a,b)},setPieceFromStickers:function(a,c){this.currentCube[b.service.targetOf(a)]=b.service.rotate(c,b.service.getRotation(a,!0)),this.render()},updateColors:function(c){a.extend(b.colors,c),this.render()},axisRotation:function(a){var b=a.charAt(0),c=a.charAt(1),d="-"==c?-1:1,e="L"==b||"M"==b?-1:"R"==b?1:0,f="U"==b||"E"==b?-1:"D"==b?1:0,g="F"==b||"S"==b?-1:"B"==b?1:0;e=("x"==b?1:e)*d,f=("y"==b?-1:f)*d,g=("z"==b?-1:g)*d;var h=0!=e?"x":0!=f?"y":0!=g?"z":b,i=e>0||f>0||g>0?"+":0>e||0>f||0>g?"-":c;return h+i},rotatedPieces:function(a){var c={};if(a){var d,e,f,g=a.charAt(0),h=null;!h&&null!=b.pieces.axis[g]&&(h=b.pieces.pieces),!h&&null!=b.pieces.slices[g]&&(h=b.pieces.slices[g]),!h&&null!=b.pieces.faces[g]&&(h=b.pieces.faces[g]);for(d in h)h.hasOwnProperty(d)&&(e=b.service.targetOf(h[d]),f=this.orientedPiece(e,a),c[e]=b.service.getStickersFromPiece(f,this.currentCube,!0))}return c},orientedPiece:function(a,c){var d,e,f,g,h=this.axisRotation(c),i=b.pieces.axis[h.charAt(0)],j="-"==h.charAt(1)?-1:1,k=a.split(""),l=[];for(d=0;d<k.length;d++)g=k[d],e=i.indexOf(g),-1==e?l.push(g):(f=e+j,f=0>f?i.length-1:f>=i.length?0:f,l.push(i[f]));return l.join("")}},c}(jQuery,b),d=function(a,b,c){function d(a,c){b.call(this,a,c),this.renderOrder=["DBL","DB","DRB","DL","D","DR","DLF","DF","DFR","BL","B","BR","L","R","FL","F","FR","ULB","UB","UBR","UL","U","UR","UFL","UF","URF"],this.renderOptions={backfaces:!1,highlights:[]},this.iso={container:this.$el,engine:f},this.iso.engine.init(this.iso.container,{worldSizeWidth:400,worldSizeHeight:300}),this.iso.layer=this.iso.engine.addLayer("cube"),this.iso.console=this.iso.engine.addLayer("console");var d=this.iso.console.addChild(new j("cubeletInfo"));d.position=new g(-200,120),d.setFont("Open Sans",20),this.render()}function e(a,b){return a.length>b?a[b]:a[a.length-1]}var f=new c,g=f.packages.core.Point,h=f.packages.display.Sprite,i=f.packages.display.Shape,j=f.packages.display.Text;return d.prototype=Object.create(b.prototype),d.prototype.willRender=function(){},d.prototype.didRender=function(){this.iso.layer.render(),this.options.showAxis&&this.iso.engine.draw.axis(this.iso.layer,200)},d.prototype.render=function(a){var b;return this.willRender(),this.renderOrder.forEach(function(c){0==this.renderOptions.highlights.length?(b=this.currentCube[c],(!a||a.indexOf(c)>-1)&&this.drawPiece(c,b,!1,this.renderOptions.backfaces)):(b=this.renderOptions.highlights.indexOf(c)>-1?"light":"grey",this.drawPiece(c,b,!0,this.renderOptions.backfaces))}.bind(this)),this.didRender(),!0},d.prototype.getImage=function(){return this.iso.layer.getCanvas().toDataURL()},d.prototype.backfaceState=function(){return this.renderOptions.backfaces},d.prototype.backfaceToggle=function(a){this.toggleRenderBackFaces(a)},d.prototype.highlight=function(a){this.highlightPieces(a)},d.prototype.highlightPieces=function(b){var c=[];b&&b.forEach(function(b){c.push(a.service.targetOf(b))}.bind(this)),this.renderOptions.highlights=c,this.render()},d.prototype.toggleRenderBackFaces=function(a){this.renderOptions.backfaces=null!=a?a:!this.renderOptions.backfaces,this.render()},d.prototype.drawPiece=function(b,c,d,e){c||(c=b);for(var f,h,i=this.options.pieceSize,j=new g(-i/2,-i/2,-i/2),k=[],l=[b.indexOf("U"),b.indexOf("R"),b.indexOf("F"),b.indexOf("D"),b.indexOf("B"),b.indexOf("L")],m=0;m<l.length;m++)f=-1==l[m]?null:c.charAt(l[m]),(!e||m>=3)&&(h={name:f,color:f?d?a.colors[c]:a.colors[f]:null}),k.push(h);var n=-1!=b.indexOf("D")?-1:-1!=b.indexOf("U")?1:0,o=-1!=b.indexOf("F")?1:-1!=b.indexOf("B")?-1:0,p=-1!=b.indexOf("L")?-1:-1!=b.indexOf("R")?1:0,q=!0;this.iso.layer._children["_piece_"+b]||this.addCube(b,j.add([i*p,i*o,i*n]),i,q),this.drawCube(b,c,i,{fills:k,stroke:a.colors.core},q)},d.prototype.addCube=function(a,b,c,d){var e=new h("_piece_"+a);e.set("position",a),d&&(e.addChild(new i("_face_D")).set("position","D").position=b.add([0,0,0]),e.addChild(new i("_face_B")).set("position","B").position=b.add([0,0,0]),e.addChild(new i("_face_L")).set("position","L").position=b.add([0,0,0])),e.addChild(new i("_face_U")).set("position","U").position=b.add([0,0,c]),e.addChild(new i("_face_R")).set("position","R").position=b.add([c,0,0]),e.addChild(new i("_face_F")).set("position","F").position=b.add([0,c,0]),this.iso.layer.addChild(e)},d.prototype.drawCube=function(a,b,c,d,f){var g=this.iso.layer._children["_piece_"+a];if(g){g.set("sticker",b);var h=d.fills.map(function(a){return a&&a.name}),i={fills:d.fills.map(function(a){return a&&a.color}),color:d.stroke};f&&i.fills&&6==i.fills.length&&(this.setShape(g._children._face_D,e(h,3),"get3DPolygonSquare",c,i.fills?e(i.fills,3):null,i.color),this.setShape(g._children._face_B,e(h,4),"get3DPolygonSquareLeft",c,i.fills?e(i.fills,4):null,i.color),this.setShape(g._children._face_L,e(h,5),"get3DPolygonSquareRight",c,i.fills?e(i.fills,5):null,i.color)),this.setShape(g._children._face_U,e(h,0),"get3DPolygonSquare",c,i.fills?e(i.fills,0):null,i.color),this.setShape(g._children._face_R,e(h,1),"get3DPolygonSquareRight",c,i.fills?e(i.fills,1):null,i.color),this.setShape(g._children._face_F,e(h,2),"get3DPolygonSquareLeft",c,i.fills?e(i.fills,2):null,i.color)}},d.prototype.setShape=function(a,b,c,d,e,f){e?a.setRenderInfo(this.iso.engine[c](d),{strokeColor:null==e?null:f,fillColor:e,strokeSize:1}):a.setRenderInfo(null),a.set("sticker",b)},d}(b,c,a);return d}();